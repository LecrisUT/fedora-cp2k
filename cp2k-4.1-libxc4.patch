diff -up cp2k-4.1/src/xc/xc_libxc_wrap.F.libxc3 cp2k-4.1/src/xc/xc_libxc_wrap.F
--- cp2k-4.1/src/xc/xc_libxc_wrap.F.libxc3	2016-06-21 13:30:13.753895000 +0200
+++ cp2k-4.1/src/xc/xc_libxc_wrap.F	2017-10-23 16:04:49.570549145 +0200
@@ -58,14 +58,16 @@ MODULE xc_libxc_wrap
                                              XC_HYB_GGA_XC_O3LYP,&
                                              XC_HYB_GGA_XC_X3LYP,&
                                              XC_HYB_GGA_X_N12_SX,&
-                                             XC_HYB_MGGA_X_M11,&
                                              XC_LDA_C_1D_CSC,&
                                              XC_LDA_C_2D_PRM,&
                                              XC_LDA_C_XALPHA,&
                                              XC_LDA_X,&
                                              XC_LDA_X_1D,&
                                              XC_MGGA_X_M11_L,&
+#if ( XC_MAJOR_VERSION == 2)
+                                             XC_HYB_MGGA_X_M11,&
                                              XC_MGGA_X_MS2H,&
+#endif
                                              XC_MGGA_X_TB09
 #else
    ! Functionals which require parameters
@@ -91,17 +93,13 @@ MODULE xc_libxc_wrap
   USE kinds,                           ONLY: dp
   USE xc_f90_lib_m,                    ONLY: xc_f90_func_end,&
                                              xc_f90_func_init,&
+                                             xc_f90_func_set_ext_params,&
                                              xc_f90_functional_get_number,&
 !
                                              xc_f90_gga_exc,&
                                              xc_f90_gga_exc_vxc,&
                                              xc_f90_gga_fxc,&
-                                             xc_f90_gga_lb_set_par,&
                                              xc_f90_gga_vxc,&
-                                             xc_f90_gga_x_hjs_set_par,&
-                                             xc_f90_gga_x_wpbeh_set_par,&
-!
-                                             xc_f90_hyb_gga_xc_hse_set_par,&
 !
                                              xc_f90_info_family,&
                                              xc_f90_info_kind,&
@@ -110,23 +108,17 @@ MODULE xc_libxc_wrap
                                              xc_f90_info_flags,&
 !
                                              xc_f90_lda,&
-                                             xc_f90_lda_c_1d_csc_set_par,&
-                                             xc_f90_lda_c_2d_prm_set_par,&
-                                             xc_f90_lda_c_xalpha_set_par,&
                                              xc_f90_lda_exc,&
                                              xc_f90_lda_exc_vxc,&
                                              xc_f90_lda_fxc,&
                                              xc_f90_lda_kxc,&
                                              xc_f90_lda_vxc,&
-                                             xc_f90_lda_x_1d_set_par,&
-                                             xc_f90_lda_x_set_par,&
 !
                                              xc_f90_mgga,&
                                              xc_f90_mgga_exc,&
                                              xc_f90_mgga_exc_vxc,&
                                              xc_f90_mgga_fxc,&
                                              xc_f90_mgga_vxc,&
-                                             xc_f90_mgga_x_tb09_set_par,&
 !
                                              xc_f90_pointer_t,&
 !
@@ -518,31 +510,7 @@ CONTAINS
 !      result in wrong numbers or a crash.
 !      --> LibXC needs to provide more informations via a function.
       IF (params(1) < 0.99e20_dp) THEN
-         SELECT CASE (func_id)
-         CASE (XC_LDA_X)
-            CALL xc_f90_lda_x_set_par(xc_func, params(1), NINT(params(2)), params(3))
-         CASE (XC_LDA_C_XALPHA)
-            CALL xc_f90_lda_c_xalpha_set_par(xc_func, params(1))
-         CASE (XC_LDA_C_2D_PRM)
-            CALL xc_f90_lda_c_2d_prm_set_par(xc_func, params(1))
-         CASE (XC_LDA_C_1D_CSC)
-            CALL xc_f90_lda_c_1d_csc_set_par(xc_func, NINT(params(1)), params(2))
-         CASE (XC_LDA_X_1D)
-            CALL xc_f90_lda_x_1d_set_par(xc_func, NINT(params(1)), params(2))
-         CASE (XC_GGA_X_LB)
-            CALL xc_f90_gga_lb_set_par(xc_func, NINT(params(1)), params(2), params(3), params(4))
-         CASE (XC_MGGA_X_TB09)
-            CALL xc_f90_mgga_x_tb09_set_par(xc_func, params(1))
-         CASE (XC_HYB_GGA_XC_HSE03, XC_HYB_GGA_XC_HSE06)
-            CALL xc_f90_hyb_gga_xc_hse_set_par(xc_func, params(1), params(2))
-         CASE (XC_HYB_GGA_XC_HJS_PBE, XC_HYB_GGA_XC_HJS_PBE_SOL, &
-               XC_HYB_GGA_XC_HJS_B88, XC_HYB_GGA_XC_HJS_B97X, &
-               XC_GGA_X_HJS_PBE, XC_GGA_X_HJS_PBE_SOL, &
-               XC_GGA_X_HJS_B88, XC_GGA_X_HJS_B97X)
-            CALL xc_f90_gga_x_hjs_set_par(xc_func, params(1))
-         CASE (XC_GGA_X_WPBEH)
-            CALL xc_f90_gga_x_wpbeh_set_par(xc_func, params(1))
-         END SELECT
+         CALL xc_f90_func_set_ext_params(xc_func, params(1), params(2), params(3))
       END IF
 
       IF (IAND(xc_f90_info_flags(xc_info), XC_FLAGS_HAVE_EXC) == XC_FLAGS_HAVE_EXC) THEN
